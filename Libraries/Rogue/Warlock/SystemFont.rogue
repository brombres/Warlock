library Warlock

class SystemFont : Font [singleton]
  PROPERTIES
    is_loaded : Logical

  METHODS
    method init
      internal_height = 17
      fixed_width     = 9
      snap = true

      ascii_characters = Dim<<FontCharacter>>(128)
      character_lookup = [Character:FontCharacter]
      forEach (unicode at i in ' '..'~')
        local font_ch = FontCharacter( unicode, XY(9,17) )
        ascii_characters[unicode] = font_ch
        character_lookup[unicode] = font_ch
      endForEach

    method init( existing:SystemFont )
      prior.init( existing )
      is_loaded = existing.is_loaded

    method load [override]
      if (is_loaded) return
      is_loaded = true

      local bitmap = Bitmap.decode( png_data )
      local texture = Texture( bitmap )
      forEach (unicode at i in ' '..'~')
        local placement = Box( placements[i], fixed_width, internal_height )
        local font_ch = ascii_characters[unicode]
        font_ch.image = TextureImage( Texture(texture,placement) )
      endForEach

  GLOBAL PROPERTIES
    png_data = Byte[](
      "iVBORw0KGgoAAAANSUhEUgAAAQAAAACACAYAAADktbcKAAAAAXNSR0IArs4c6QAAADhlWElmTU0"...
      "AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAABAKADAAQAAAABAAAAgAAAAAA+mF"...
      "tEAAAUdElEQVR4Ae1di5bjOK7b2XP//5fnmirDCyGURMlO4nKxzsnqBZAgJCupnnTvP/957s+/U"...
      "to/Mtah4m19xNEYOU4HfpUD//er1E6K/fffn2f6n3+az3H10ANvaXaOrTfJk3ISng7czoGzF0D1"...
      "AG3VeQ+LYlomeFzD9vgznO7DjIffHnzr26tzcaAGT1tLEzheTRHOLE+1RXOwzr/en/FQsfBu5Lv"...
      "yenjFRnJ0OWcugBKYH5xNjc01CxBsecisgtGDxjzuG5d+qkKBs3Xrn3hH15qaeWZyQN+odq1vhi"...
      "dYrYNCZ7flgHjYhNkCsADReTim0NnbcpbAa5yF5nmzGJSDn7sw578iaGoI4Ubi/lQQH2wF4OUjf"...
      "maBcQs2c2DqSJ/ibDziYF25PcFn1jTfKNaCLvZT+710M9henDutVWdqJIz3puP7i0/gjeLbOrAW"...
      "v5OjCjXinPkEUCV61wAFWHztw4RR7g6uujUZx7lG8T+w7h1G1u5JsHXl2bjLQ93mBfe9BDw3g2X"...
      "enfurNYHXqy2C6fGvWvvoBcAPmBWgY68oPYgwrscFx7CE6x58k7O9ygMTyWFaOQ/G1kZ+SFcEPv"...
      "UwckDW2MhZXRKMtzjEqXCcw+kDO/LcoVZTiFNNOoOzeTSkl/fSHOTrsbcqQsfM0bXWeMQ5dQFY8"...
      "MDDsmIcc7zNQL2Mw5y1/0IbXQIWp4UvnPI/26VhP2Rck9OpXTVrDB2XnBP/E+UbTrU006AeBmCO"...
      "/ODlY/8xOcIDN9sirvJauhQ3O0a+lfjGAV/yevs22h/lFDziN/S9cIA3Pcw5cwF4h0sTS/3h4cg"...
      "UBGIc5y7asBFW/F604RnH/GPT2KANrxzkrlo22BYkRoW96wCauRbMtTRjHRyMW/jV+XfFdfRUZ2"...
      "Jf5zPjUP43RWftf5PX9Yo2x2vV91ID/DMuazxzAZSyEPi6GutIKNZmtS+5X4o2jmG0aJvXH8QGH"...
      "ut7Djc2MNYyb+fw8p37fHg2G35KRT023uthnNaj/vSw4CrH5pWnY3Bn2kieKh57UC18Z1Dpd7R1"...
      "PXLwVRWnL4BRgirbwgAH0ajab4Vb1aTxLY699gegle4b83Youhu/i6oOT0Qo18r9EXcGi1jYJxu"...
      "v8BFn1Aby9HyK+HxI+EQdkgPap3RC8OkLAIEubrkYFOilcHFmEB5ekMQ0TB/taP0AUkfz8HglHo"...
      "V+6a7GxuEP6mE/XzR0JlZ5nZDfWZr06xDJ+4PJoOeAh1toBKGXZ6Tr7Mbpw3k2HmriVnPwWitf4"...
      "cAoMqiFR8yKZ5PEBYZj9LQBX8LwYLG/lfOTjjSxFg1b1bJzenjlv3v8KX3eHqkPB0Y8VlzPkyOG"...
      "gEYxlKd4XZfwx1B5WGjxC75FAvk3t/rARGv1DIty3+lX0TVxQLV+03aHOuDRnfR5e343v+Dbpe2"...
      "dDsSlhW3BdFOfUOtMTTPYq72PxLu7vkgNiUkH0oF0IB1IB9KBdCAdSAfSgXQgHUgH0oF0IB1IB9"...
      "KBdCAdSAfSgXQgHUgH0oF0IB1IB9KBdOA2DuDLMdEvZSiuVQjieuteDMV7GC+W8oBp8Vt4461wk"...
      "O+Trers1RTRpfHAicZd4bc4lruXV3keVjGoh1uPh/UWXzktHOIo3uZHHI+7wkGcXs6i7/jLQPIV"...
      "Uw7g9oHXRfqeui4dY+aO8Iw9Amwdh1cZpbwdbxjemBUOy/h0v+hFbY4Hp/RIXPWKY6/41uVYcNo"...
      "j5HrZqwmN1V8fPwJuf1Fs+9HautpIF+tByJc8I3wRsP+9jiPI3untKWoPcML1HBeABOUAbtHA9w"...
      "QDQy3HxYbT8mtX47dMYCYw4NrYXhgzFv0Vzs6tatrnup5tmGWO6oT+K1rzR7wynd1aVI/wXVnKM"...
      "VCDV/kEHvD7fg41Yt8bOSqNyDHDQYAV/5AHMSLtDGdUj3sBKCkgqndI3E0cFOHF22T9hBpwA3Kv"...
      "hUCXRY1qm+SUwsGhHOpT5XWnSuZxf+WfUuukuW5Ja7exvciL65KdiGR6FrTxHkSzr3BeYrsXwAt"...
      "qPMEHrykMm2jh0N830PhNnsGNIz89fIHe8YBIDb1hVbP4Zbxu/cBrgsEDYzGnLgGOh5w8p/m9MX"...
      "je2rfnZmtZ1Mt73d1Xir/Cebkw7QLgQBQ/1uXN282yeN0iYKpx7YVxLyPyRLCGAR5thNfL31tbi"...
      "T3DcWro+mtaZ+JLba1LgGGaf5P4c4wor2KYf/SZh/6xeFGH45K+SPRQDZFALcyKthVOK3/5BICA"...
      "DXPcC0KxFsNeOt9KPDHv5e9uDNeD/kib6TYM8BP6uloacaY4rG33d3jJtuoI7E/xG/wA3itxqj4"...
      "vQGsOulrr3jxqMK69MPawMqdn7/K6JrQc0lY4RmbvEKP6FYABIAC4Z/cMUJN26HUNdImWUALjgO"...
      "8QuJ7y0dcwwAfzefVzXCet+6lLOTye+lhuCYPaVVvr4WctyinjxXxFp/kNz93gNIk8UTxRl7rIg"...
      "7xLQcakob9OiGmO1YB6EK9cAFocQDq/kbzDfgR18MhzZTtd+Exyp/ZhPnAsT9SDSY5piFwCQ62O"...
      "F9WeQhfVEYrp8JxU/hTl8gG/aHbRh2oPtnJDnl9hi10Amqwn5lhDoRBBm6jxAHFve+IduLMdi2n"...
      "6WGMkD+N3Dc1azmpc4JsW7xJYCOVTUD959Zb6vf2BIsqNqdMt6rJAo/iethEHApGH8EP/wEEM4m"...
      "LqVOvVwwE9gcdDvgMZo2scy/qM1TUbt/g9nnJ6WORUDuZ7XI/TwyPmCq9wsPn7pkdyWU7NF+VBr"...
      "7YaD+szcTXGiKt45FxtOV8kNuM1Z4uvnBYO8RRv8yOOx21xvPjgc9viG2Z7q8yfbziwPfs/+0I3"...
      "fu7FN3bij+fMQ/edA6C3cu7Dd/Yhs6YD6UA6kA6kA+lAOpAOpAPpQDqQDqQD6UA6kA6kA+lAOpA"...
      "OpAPpQDqQDqQD6UA6kA6kA+lAOvAYB+wLKPqlFC2u9SWVFq+F17jKZ56uKRfjCIcx4KFt5TFOaw"...
      "1cbXsc1tCKyxiL3cJxXuXwWouvnBaOYymH11p85bRwHMv6zPs2x7RENWgdGH+jHuS2tqW/6HL/P"...
      "QDna6oc8OgDhwn6Wiumui34PZ5idOwliGCU53G8OeZ5697cxqk2ARjE2us3DB8WLFd/qQmTDc6v"...
      "zWN1vfscwPeZPKZrxNN1HVsM/VGMjhVvY2B0rVePx2P8fzXYzJgDcX8mxk2x1YMU1BjiYBPNL3i"...
      "GuVGeGQ5iznCQf4azkofjW04dQ0e2tQPwCW29Oh55vDMXgPdu5c2NlQURfNiClGkYcqCNBJjBRu"...
      "L9Zox3yPZ67GzwS8vEms5/cxy61K1m++FzgLkLxMMXbs+ERZwS48wFcEbEFdwf16+IRDFs42wjZ"...
      "zeQN5/CPb4Ln6T+6pD9VhOkJi0DNZZzyD6gvxHecUbLpQRtlEv1hcbVBWBBETjE/iAIus4W/A7J"...
      "0ASN78hhMXl/kPMduQJ5mod/1xN653yH9t8SE/sX8JpLaj38yxdNdQGYKAjjrCf7Jtp7TYWFrnc"...
      "/ZFOiCAx9NHV5F/tDuZY3vieO4vdgWCsawKH9efolwGe6+tTY8cC9OM1I+GddGLu3L3lsvoMXen"...
      "9YXQB96PlVvu3OR6v/ZP2CeEcIMveYi3RWeZHYhKkOEc1f2kUtdJg5Ph/K40EfcJh/2z7XYH3Uj"...
      "3lPODC2BhzPeRyDOvPe3AFDTORoxDjwkc6ZC+DYeErkzdHyuS4KhxHBaO5hHXC7G9HgrnAaoX7P"...
      "tO3F5H58rDg+L9CIORFhe4eXLFVDYO6y13y2K6HRQfXPgkdJwMFUG1u/YS7gZd1wzBtxDvJCh/M"...
      "Y/Z25ovJMwyc8+MN5+OE8/hFV2X/GRLfuNrgrz7UZMXrXbpnV4rXwZmCU08LpJnCuKzkRXzwtLQ"...
      "0RnYyZ8Up1YHxowYGhC5BzHTgQGy1zGNLit/DgKm8WjzizvFk88ljLXNXPOO4zh+etrzE8rGI0B"...
      "sYet+SQ/a9w1QCRsn2UA+UA9Q7Bo6rNYtSBbet/7hB6AzBMefbzAlC7njnWd5Hc92fus1fVcQFg"...
      "cb8I8gKAIdmmAw92QC9/lJpvAnAi23QgHUgH0oF0IB1IB9KBdODvOPCN3wP0d5J3aNActqPvyPN"...
      "3TkpW+kgHznwT8JGGZFHpwF9yIC+Av7TbWWs6IA6c+iqwxIoMy0dz+WKCzV3+8Rw5TJR8ASKiMz"...
      "H3dEB/tYuem1XePV24UJUZuGqO8iBLN6XC8YNpBHo4lYd4K23JiVwX56jqIXFX6qewL13Nf3Vej"...
      "Q8BZ/NcEXfb0p8w/GUWCOy0I96KthYHMs76hThvbd1/FDSaEZsBPD1omKpa4IGzsb0wrsDnBmb+"...
      "8RdB3pTj+EtNb9DfrV597ILnFsuhRnxQr64P8a+OC71n2hVt4CDvHeuCNm29XwHsEIRuLxSqBmg"...
      "SjIFvjTF/UXtcAsF4rRs95MWWg/k9DuNY2gqH+dpfybNyqbXymJ5eTdDLfMXzWsHrGUKQRnvwJ3"...
      "kId/D3CdVXphE78BxoPOTRlvNEOIzXWC1+4ZQLwAow8fZCMRrFGSNpKwEowGH8yXYqt27g7oXV1"...
      "43DvAan8ojxZsYKp2HiSp5GqDLdqrubx5iRc8Q+NDw4tDE2Gt9wqzwkBt+pR72pPAG/1SKurpMP"...
      "uvRSiwEIz3oqLZqLOfZfAZiIpFUATD69NWPwslrVuFb9MxzEPMtpacH8RB7ba7xAR4v55nnw8oA"...
      "8amc8YOwoLq+v8jjGO/umz37Qws9eTq5phMd6i3P8CmAAA9sLYnoicu0aB+7kNQ6LVcb9L2rUN6"...
      "fmRdTYDfBneSUcPPhi/Y2yrpvGBWBGqUk2hoHXZbxXpKpmbPgHJb7d35ma7KAD/+RDH9lfx4e37"...
      "1VE19UYXAAlLg6AFf/XDoBuOMZXGy7xqgtoW7v8kAX2kXO+XY/Uf9uh8yw88g2RvwnIBwEbowcC"...
      "89le5IBdNB+6bKDY22es3a2188cv1Yc1nb9kjMuzsT/IjVZztuYV99Vx9QnAlDg331cFfio51z2"...
      "bkw8IDk0rhpdnhdOKj/mVPODOtF6eGX4Uyx4bB+ORd9H4Z3DQghgYR7VFcYg/03r7w/m8d4NNv1"...
      "1ex59MehjWMItn7p36P0X7itiDHg5sxmMObYu/wrGYLd4VeVqxUYu1VZ7O2alwHED6nHOFI+HKc"...
      "HRGV/JcybGao/G8+myOfWNMK27Bv3wCKJH2/zTBUZx+K7ADnZ5aid0yIJo8yo/iWnlX+HfjfGp/"...
      "Vuq+s7ZePb211lmKzHfjehdAl8AZcdvz3NX9Xg7+KHN13owXc8Dbn7vsi2q7i66Ys59BhR92R07"...
      "rpj0TE2lasbHutVfk9eLm3KsDkf351n6MtH1L16uLOZMOpAPpQDqQDqQD6UA6kA6kA+nAZx3I34"...
      "c+63dmu6UD+3/3vqW294ribwK+N1NGTwfSgds5kBfA7bYkBaUDn3MgL4DPeZ2Z0oHbOeB9Eeh2I"...
      "hcE6X8Lzj/rWDBxkjLr+bvxJt/LoXOTZT4L/thPAPYtMP0m2LO27lbVlIdq1vOT+NaDbPN4lTNA"...
      "5+DQeSv3vijGPgG0jDRZvXfOKK+H49JbuXp85vRwvBbltLRxLMZoP5LHMNF4Gh/jSB5g0Z7lIM7"...
      "R4iF759dtLTYujUgeaDKR3D9EZ+c/5VcAz5zdYDuczcPS4bnWAo/N0zGRqocCOFrv/oMljOc+8n"...
      "Ic9IEDRsfAcasYHTMWfcGUOmUO0KPVdR0fQOooRscEPbrAHBN7B57ofGfMZ6YDm1qymNW5iLBZO"...
      "+rjuUiMJ2OqPwOAMWaUvTD2DFAzMfaw3lwUD1xPi8Y37ApP47x7bBpn6nq3HtUCDwd5px/KQbyZ"...
      "ZcvdvGyonnJ50NhyMO+bNczUezm2ugAuj94IeNHB5w20TDzWDeW1hqr7TtvBNc/4gZTDfEa8elO"...
      "8Q65GnsrfAfaMthcue7FrMy1cA/eZ35pnzJ/rf+UPAelQ2abg5ZoPLB4AHLYNXB1Cl/y7J+FLOb"...
      "jwwUqiflm7sMzWw9/Mg/14oyYur/ICuRmQ/TkHvnIB7BKbh2pbtzW8yoG3A4ZD9kc23h5GvKp3f"...
      "6r/iksQOUosxIbX+z5sjf8DHHgb6gpNfrI9NnIhdwuc82MHvnkB9NRVh7IHDK5dHa+kxQG0Axk9"...
      "lMyxfoTHGOYHaw/DOA+R4B1NHZfzx9+RHY29NxLWnH3HgerPAGCu4XDQHE6ZwuFlTgt7Zt6LP9J"...
      "m+Tx9PZ6Hb+jmA3f8H5Ai585hTFmiWL13SOb1cBTO73r19OrnKOr5gGeaT2nl3JN99muSmnBzoL"...
      "oAnI1Wg3lcDj9s1EODeW6d+Lzs9jsc1qJcW6v0KWAfc4wIXsN4eTim4suYa+K+C94mFaNj4nHuo"...
      "x7ZG8YQ9TVPtTg3sAuhmWcu1IH+1iVzCHhip7oA9gKjG8e43uYwLurhCkdjz8aYxSPfLC+Kj+Kg"...
      "w9qXfcDDH7w0ONZU3+JbLnt1ck3FVHCgFqXkeOCAdwEMKLn8GxzAw2Ja6YFcuVQi5Vrc4xNHhLC"...
      "CoTqM/q5aVqT9Wk7ZOFG/Yqy+86zEEBk5XHBA94FD3G1PVOsX9W0fW/7ozxdN/6OOZ9k3dODvXg"...
      "B3/c+ANzwkKSkdeJ4DeQE8b0+zonQg7MD2K8Df/fgTdimB6cBDHchPAA/d2CwrHYg4kBdAxKXEp"...
      "AMPdSAvgIdubJaVDkQcyAsg4lJi0oGHOpAXwEM3NstKByIO5AUQcSkx6cBDHcgL4KEbm2WlAxEH"...
      "8gKIuJSYdOChDuQF8NCNzbLSgYgDeQFEXEpMOvBQB/ICeOjGZlnpQMSBvAAiLiUmHXioA3kBPHR"...
      "js6x0IOJAXgARlxKTDjzUgbwAHrqxWVY6EHEgL4CIS4lJBx7qQF4AD93YLCsdiDiQF0DEpcSkAw"...
      "91IC+Ah25slpUORBzICyDiUmLSgYc6kBfAQzc2y0oHIg7kBRBxKTHpwEMdyAvgoRubZaUDEQfyA"...
      "oi4lJh04KEO/D+ATIS956djZgAAAABJRU5ErkJggg==",
      &base64
    )

    placements = XY[][
      XY( 0, 0 ),
      XY( 13, 0 ),
      XY( 26, 0 ),
      XY( 39, 0 ),
      XY( 52, 0 ),
      XY( 65, 0 ),
      XY( 78, 0 ),
      XY( 91, 0 ),
      XY( 104, 0 ),
      XY( 117, 0 ),
      XY( 130, 0 ),
      XY( 143, 0 ),
      XY( 156, 0 ),
      XY( 169, 0 ),
      XY( 182, 0 ),
      XY( 195, 0 ),
      XY( 208, 0 ),
      XY( 221, 0 ),
      XY( 234, 0 ),
      XY( 247, 0 ),
      XY( 0, 21 ),
      XY( 13, 21 ),
      XY( 26, 21 ),
      XY( 39, 21 ),
      XY( 52, 21 ),
      XY( 65, 21 ),
      XY( 78, 21 ),
      XY( 91, 21 ),
      XY( 104, 21 ),
      XY( 117, 21 ),
      XY( 130, 21 ),
      XY( 143, 21 ),
      XY( 156, 21 ),
      XY( 169, 21 ),
      XY( 182, 21 ),
      XY( 195, 21 ),
      XY( 208, 21 ),
      XY( 221, 21 ),
      XY( 234, 21 ),
      XY( 247, 21 ),
      XY( 0, 42 ),
      XY( 13, 42 ),
      XY( 26, 42 ),
      XY( 39, 42 ),
      XY( 52, 42 ),
      XY( 65, 42 ),
      XY( 78, 42 ),
      XY( 91, 42 ),
      XY( 104, 42 ),
      XY( 117, 42 ),
      XY( 130, 42 ),
      XY( 143, 42 ),
      XY( 156, 42 ),
      XY( 169, 42 ),
      XY( 182, 42 ),
      XY( 195, 42 ),
      XY( 208, 42 ),
      XY( 221, 42 ),
      XY( 234, 42 ),
      XY( 247, 42 ),
      XY( 0, 63 ),
      XY( 13, 63 ),
      XY( 26, 63 ),
      XY( 39, 63 ),
      XY( 52, 63 ),
      XY( 65, 63 ),
      XY( 78, 63 ),
      XY( 91, 63 ),
      XY( 104, 63 ),
      XY( 117, 63 ),
      XY( 130, 63 ),
      XY( 143, 63 ),
      XY( 156, 63 ),
      XY( 169, 63 ),
      XY( 182, 63 ),
      XY( 195, 63 ),
      XY( 208, 63 ),
      XY( 221, 63 ),
      XY( 234, 63 ),
      XY( 247, 63 ),
      XY( 0, 84 ),
      XY( 13, 84 ),
      XY( 26, 84 ),
      XY( 39, 84 ),
      XY( 52, 84 ),
      XY( 65, 84 ),
      XY( 78, 84 ),
      XY( 91, 84 ),
      XY( 104, 84 ),
      XY( 117, 84 ),
      XY( 130, 84 ),
      XY( 143, 84 ),
      XY( 156, 84 ),
      XY( 169, 84 ),
      XY( 182, 84 )
    ]
endClass
